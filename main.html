<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>main</title>
<link href="style.css" rel="stylesheet" type="text/css">

</head>

<body>
	
	<h1>Game</h1>
	
	<div id="window" >
		<canvas id="game" width="800" height="800">Sorry your browser does not support the HTML Canvas Option.</canvas>
	</div>
	
<script>
		var c = document.getElementById("game");
		var ctx = c.getContext("2d");
		var xMain;
        var pause = false;
        var pWait = 0;
		var sx = 100;
		var sy = 100;
		var wx = 50;
		var wy = 50;
		var w = c.width;
		var h = c.height;
		var randomColor = '#ffd6cc';
		var rDown = false;
		var lDown = false;
		var uDown = false;
		var dDown = false;
		var attackb = false;
		var attackz = false;
		var attackx = false;
		var power = 50;
		var cool = 0;
		var health = 100;
		var dead = false;
		var score = 0;
		var highscore = localStorage.getItem("highscore");
		var recent = 'right';
		var damaging;
		var speed = 1.5;
		var regeneration = false;
		var Otime = 0;
		
		//HELPER FUNCTIONS
		function random(a) {
			var rand = Math.random() * 10;
			if (rand - 5 > 0 && a < 60) return a + .5;
			else if (rand - 5 <= 0 && a > 40) return a - .5;
			else return a;
		}
		
		function srandom(a) {
			var rand = Math.random() * 10
			if (rand > 5) return a + 0.2;
			else return a - 0.2;
		}
		
		function mxrandom(a) {
			var rand = Math.random() * 10;
			if (rand > 5 && a < w - wx - 10) return a + 0.1;
			else if (rand <= 5 && a > 10) return a - 0.1;
			else return a;
		}
		
		function myrandom(a) {
			var rand = Math.random() * 10
			if (rand > 5 && a > 10) return a - 0.1;
			else if (rand <= 5 && a < h - wy - 10) return a + 0.1;
			else return a;
		}
		
        function pauseSwitch(){
            if(pause && pWait >= 10){
                pause = false;
                pWait = 0;
                window.requestAnimationFrame(main);
            } else {
                pause = true;
            }
        }
        
		//CHARACHTER
		function drawChar() {
			randNum = Math.round(Math.random() * 2);
			//randomColor = colors[randNum];
		
		
			ctx.fillStyle = randomColor;
			ctx.fillRect(sx, sy, wx, wy);
		
			ctx.lineWidth = 1;
		
			ctx.beginPath();
			ctx.fillStyle = 'black';
			ctx.arc(sx + wx / 6, sy + wy / 6, (wx / 4 + wy / 4) / 4, 0, 2 * Math.PI);
			ctx.stroke();
			ctx.closePath();
		
			ctx.beginPath();
			ctx.arc(sx + wx - wx / 8, sy + wy / 6, (wx / 4 + wy / 4) / 6, 0, 2 * Math.PI);
			ctx.stroke();
			ctx.closePath();
		
			ctx.beginPath();
			ctx.moveTo(sx + wx / 8, sy + wy - wy / 3);
			ctx.bezierCurveTo(sx + wy / 8, sy + wy, sx + wx - wy / 8, sy + wy, sx + wx - wy / 8, sy + wy - wy / 3);
			ctx.stroke();
			ctx.closePath();
		}
		
		function moveChar() {
			if (dDown && regeneration == false) {
				sy += speed;
				sx = random(sx);
				recent = 'down';
			}
			if (rDown && regeneration == false) {
				sx += speed;
				sy = random(sy)
				recent = 'right';
			}
			if (uDown && regeneration == false) {
				sy -= speed;
				sx = random(sx);
				recent = 'up';
			}
			if (lDown && regeneration == false) {
				sx -= speed;
				sy = random(sy);
				recent = 'left';
			}
			/*if (attackb && regeneration == false) {
				clearInterval(sessionM);
				attack();
			} else if (attackz && regeneration == false) {
				clearInterval(sessionM);
				attackZ();
			} else if (attackx == false){
				regeneration = false;
			}
			*/
			sx = srandom(sx);
			sy = srandom(sy);
			wx = random(wx);
			wy = random(wy);
		
		}
		
		
		function listen() {
			document.addEventListener("keydown", keyDownHandler, false);
			document.addEventListener("keyup", keyUpHandler, false);
		
			function keyDownHandler(e) {
				e.preventDefault();
                if (pause != true){
                    if (e.keyCode == 40 || e.keyCode == 83) dDown = true;
				    if (e.keyCode == 39 || e.keyCode == 68) rDown = true;
				    if (e.keyCode == 38 || e.keyCode == 87) uDown = true;
				    if (e.keyCode == 37 || e.keyCode == 65) lDown = true;
                    if (e.keyCode == 80) pauseSwitch();
				    else if (e.keyCode == 32 && cool == 0) attackb = true;
				    else if (e.keyCode == 90 && cool == 0 && power >= 10) attackz = true;
				    else if (e.keyCode == 88 && cool == 0 && power > 0) attackx = true;
                } else {
				    if (e.keyCode == 80) pauseSwitch();
                }
                
			}
		
			function keyUpHandler(e) {
				if (e.keyCode == 40 || e.keyCode == 83) dDown = false;
				if (e.keyCode == 39 || e.keyCode == 68) rDown = false;
				if (e.keyCode == 38 || e.keyCode == 87) uDown = false;
				if (e.keyCode == 37 || e.keyCode == 65) lDown = false;
				if (e.keyCode == 88) attackx = false;
			}
		
		}

        
        function pauseMenu(){
            listen();
            ctx.font = "30px Arial";
            ctx.fillText("Pause", 20, 40);
        }
        
        
		xMain = true;
		function main(timestamp){
            ctx.clearRect(0,0,w,h);
            moveChar();
            drawChar();
            listen();
            
            pWait++;
			if(xMain && pause != true) window.requestAnimationFrame(main);
            else pauseMenu();
		}
		
		window.requestAnimationFrame(main);
	</script>
	
</body>
</html>
